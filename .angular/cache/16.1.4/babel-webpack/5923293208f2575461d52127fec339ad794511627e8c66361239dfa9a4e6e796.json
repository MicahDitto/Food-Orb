{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"./storage.service\";\nexport let UserProfileService = /*#__PURE__*/(() => {\n  class UserProfileService {\n    constructor(storage) {\n      this.storage = storage;\n      this.PROFILE_KEY = 'user-profile';\n      this.ADDRESSES_KEY = 'addresses';\n      this.PAYMENTS_KEY = 'payments';\n      this.ORDERS_KEY = 'orders';\n    }\n    // Profile methods\n    getProfile() {\n      const profileJson = this.storage.getItem(this.PROFILE_KEY);\n      return profileJson ? JSON.parse(profileJson) : null;\n    }\n    saveProfile(profile) {\n      this.storage.setItem(this.PROFILE_KEY, JSON.stringify(profile));\n    }\n    updateProfile(updates) {\n      const current = this.getProfile() || {\n        name: '',\n        email: '',\n        phone: ''\n      };\n      const updated = {\n        ...current,\n        ...updates\n      };\n      this.saveProfile(updated);\n    }\n    // Extract email from JWT token\n    getEmailFromToken() {\n      const token = this.storage.getAccessToken();\n      if (!token) return null;\n      try {\n        const payload = JSON.parse(atob(token.split('.')[1]));\n        return payload.email || null;\n      } catch {\n        return null;\n      }\n    }\n    // Address methods\n    getAddresses() {\n      const addressesJson = this.storage.getItem(this.ADDRESSES_KEY);\n      return addressesJson ? JSON.parse(addressesJson) : [];\n    }\n    addAddress(address) {\n      const addresses = this.getAddresses();\n      addresses.push(address);\n      this.storage.setItem(this.ADDRESSES_KEY, JSON.stringify(addresses));\n    }\n    updateAddress(index, address) {\n      const addresses = this.getAddresses();\n      if (index >= 0 && index < addresses.length) {\n        addresses[index] = address;\n        this.storage.setItem(this.ADDRESSES_KEY, JSON.stringify(addresses));\n      }\n    }\n    removeAddress(index) {\n      const addresses = this.getAddresses();\n      if (index >= 0 && index < addresses.length) {\n        addresses.splice(index, 1);\n        this.storage.setItem(this.ADDRESSES_KEY, JSON.stringify(addresses));\n      }\n    }\n    // Payment methods\n    getPayments() {\n      const paymentsJson = this.storage.getItem(this.PAYMENTS_KEY);\n      return paymentsJson ? JSON.parse(paymentsJson) : [];\n    }\n    addPayment(payment) {\n      const payments = this.getPayments();\n      // Mask card number before storing\n      const maskedPayment = {\n        ...payment,\n        card: this.maskCardNumber(payment.card)\n      };\n      payments.push(maskedPayment);\n      this.storage.setItem(this.PAYMENTS_KEY, JSON.stringify(payments));\n    }\n    removePayment(index) {\n      const payments = this.getPayments();\n      if (index >= 0 && index < payments.length) {\n        payments.splice(index, 1);\n        this.storage.setItem(this.PAYMENTS_KEY, JSON.stringify(payments));\n      }\n    }\n    // Order history methods\n    getOrderHistory() {\n      const ordersJson = this.storage.getItem(this.ORDERS_KEY);\n      return ordersJson ? JSON.parse(ordersJson) : [];\n    }\n    getRecentOrders(limit = 5) {\n      const orders = this.getOrderHistory();\n      return orders.slice(-limit).reverse();\n    }\n    // Utility methods\n    maskCardNumber(card) {\n      if (card.length < 4) return card;\n      // If already masked, return as is\n      if (card.includes('*')) return card;\n      return '*'.repeat(card.length - 4) + card.slice(-4);\n    }\n    // Clear all user data (for logout)\n    clearAllUserData() {\n      this.storage.removeItem(this.PROFILE_KEY);\n      this.storage.removeItem(this.ADDRESSES_KEY);\n      this.storage.removeItem(this.PAYMENTS_KEY);\n    }\n    // Check if user has complete profile\n    hasCompleteProfile() {\n      const profile = this.getProfile();\n      return !!profile && !!profile.name && !!profile.email;\n    }\n    // Get summary stats\n    getProfileStats() {\n      return {\n        addressCount: this.getAddresses().length,\n        paymentCount: this.getPayments().length,\n        orderCount: this.getOrderHistory().length\n      };\n    }\n  }\n  UserProfileService.ɵfac = function UserProfileService_Factory(t) {\n    return new (t || UserProfileService)(i0.ɵɵinject(i1.StorageService));\n  };\n  UserProfileService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n    token: UserProfileService,\n    factory: UserProfileService.ɵfac,\n    providedIn: 'root'\n  });\n  return UserProfileService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}